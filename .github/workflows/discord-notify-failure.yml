name: Discord Notification - Deploy Failure

on:
    deployment_status:

jobs:
    notify-failure:
        if: github.event.deployment_status.state == 'failure' || github.event.deployment_status.state == 'error'
        runs-on: ubuntu-latest
        steps:
            - name: Send Discord Failure Notification
              env:
                  DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
                  DEPLOY_URL: ${{ github.event.deployment_status.target_url }}
              run: |
                  curl -H "Content-Type: application/json" \
                  -X POST \
                  -d "{
                    \"content\": \"⚠️ **배포 실패!** @everyone\",
                    \"embeds\": [{
                      \"title\": \"❌ ${{ github.repository }} 배포 실패\",
                      \"description\": \"Vercel 배포 중 오류가 발생했습니다. 확인이 필요합니다!\",
                      \"url\": \"$DEPLOY_URL\",
                      \"color\": 15158332,
                      \"fields\": [
                        { \"name\": \"Environment\", \"value\": \"${{ github.event.deployment.environment }}\", \"inline\": true },
                        { \"name\": \"Commit\", \"value\": \"[\`${{ github.event.deployment.sha }}\`](https://github.com/${{ github.repository }}/commit/${{ github.event.deployment.sha }})\", \"inline\": true },
                        { \"name\": \"Branch\", \"value\": \"${{ github.event.deployment.ref }}\", \"inline\": true },
                        { \"name\": \"배포 로그\", \"value\": \"[로그 확인하기]($DEPLOY_URL)\", \"inline\": false }
                      ],
                      \"footer\": {
                        \"text\": \"Vercel Deployment Failed\"
                      },
                      \"timestamp\": \"${{ github.event.deployment_status.updated_at }}\"
                    }]
                  }" \
                  $DISCORD_WEBHOOK
